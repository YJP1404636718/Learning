{% extends 'base-test.html' %}
{% load myfilter %}
{% load staticfiles %}

{#{% load myfilter %}#}
{% block left_content %}
    <div class="postdate">
       <div class="month">{{ article.date_publish | month_to_upper }}</div>
        <div class="date">{{ article.date_publish | date:'d' }}</div>
{#    <div class="date">日期</div>#}
    </div>
    <div class="title">
        <h2><a href="" rel="bookmark" title="{{ article.title }}">{{ article.title }}</a></h2>
        <div class="postmeta">
          <span class="postmeta_author">{{ article.user.username }}</span>
          <span class="postmeta_category"><a href="" rel="category">{{ article.category.name }}</a></span>
          <span class="postmeta_time">{{ article.date_publish | date:'Y-m-d' }}</span>
        </div>
    </div>
        <div class="entry">
          {{ article.content | safe }}
        </div>
        <span class="tags">
{#            {% for tag in article.tag.all %}#}
{#            <a href="?tag={{ tag.name }}" rel="tag">{{ tag.name }}</a>#}
{#            {% endfor %}#}
        </span>
        <div class="info">
{#        Address:  <a href="{{ SITE_URL }}article/?id={{ article.id }}" rel="bookmark" title="{{ article.title }}">{{ SITE_URL }}article/?id={{ article.id }}</a>#}
        </div>

{#      <div class="commentstitle"><h3 id="comments"><span class="commentsnumber">only 1 comment</span> untill now</h3></div>#}

      <ol class="commentlist">
          {% for comment in comment_list %}
          <li id="comment-59418">
                <div class="top"><a href='{{ comment.url }}' rel='external nofollow' class='url'>{{ comment.username }}</a><span class="time"> @ <a href="#comment-59418" title="">{{ comment.date_publish | date:'Y-m-d H:i:s' }}</a></span></div>
                <div><img alt='' src='{% static 'images/default.jpg' %}' class='avatar avatar-32 photo' height='32' width='32' /></div>

                <div class="body">
                                <p>{{ comment.content }}</p>
                </div>
          </li>
          {% for children_comment in comment.children_comment %}
          <li id="comment-59542">
                <div class="reply">
                  <div class="top"><a href="{{ children_comment.url }}" rel="external nofollow" class="url">{{ children_comment.username }}</a><span class="time"> @ <a href="#comment-59543" title="">{{ children_comment.date_publish | date:'Y-m-d H:i:s' }}</a></span></div>
                  <div><img alt="" src="{% static 'images/default.jpg' %}" class="avatar avatar-32 photo" height="32" width="32"></div>

                  <div class="body">
                                        {{ children_comment.content }}                  </div>
                </div>
          </li>
          {% endfor %}
          {% endfor %}
      </ol>

    <div id="commentform">
    <h3 id="respond">快来新增你的评论吧！</h3>
    {% if not request.user.is_authenticated %}
    <div class='login_info'>还没有登陆？可以登录后再评论哦。<b><a href="{% url 'login' %}">&raquo;去登录</a>&nbsp;<a href="">&raquo;去注册</a></b></div>
    {% else %}
    <div class='login_info'><b>{{ request.user.username }}</b>,快来写点评论吧!&nbsp;<a href="{% url 'logout' %}">注销</a></div>
    {% endif %}
{#    <form action="{% url 'comment_post' %}" method="post">#}




    <form action="{% url 'commucation:comment_post' %}" method="post">
    {% csrf_token %}



{#        <div class="controls ">#}
{#            <input   id="author" name="author" value="" style="float:left; width: 45%;height: 34px;margin-top: 20px;margin-right:2rem;font-size: 14px;line-height: 1.428571429; border: 1px solid #cccccc;border-radius: 4px;",disable="True">#}
{#        </div>#}
{#        <div class="controls ">#}
{#            <input   id="comment" name="comment" value="" style="float:left; width: 45%;height: 34px;margin-top: 20px;margin-right:2rem;font-size: 14px;line-height: 1.428571429; border: 1px solid #cccccc;border-radius: 4px;",disable="True">#}
{#        </div>#}



    <p >{{ comment_form.author }}

    <p>{{ comment_form.comment }}</p>

    <p>
        {{ comment_form.article }}

    </p>
        <input  type="input" id="submits" tabindex="5" value="提交评论" style="text-align: center;margin-left: 180px; height: 34px;width:60px;background:red;margin-top: 20px;font-size: 14px;border: 1px solid #cccccc;border-radius: 4px;" />
    <p>

    </p>
    </form>
    </div>

    <script>
      $("#submits").on("click",function () {
          var author = $("#author").val()
          var comment = $("#comment").val()
          var article = $("#article").val()
          $.ajax({
                cache: false,
                type: "POST",
                url: "/commucation/comment/post/",
                data: {
                    author: author,
                    comment: comment,
                    article:article,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                },
                async: true,
                success: function(data) {
                    if(data.status=="success") {
                        alert("成功");


                        parent.location.reload();

                    }

                    else if(data.status=="exists") {
                        alert("存在违禁关键词，请重新输入")
                    }
                },
                error:function (data) {
                    alert("发布失败");
                }
            });
      })
    </script>
{% endblock %}